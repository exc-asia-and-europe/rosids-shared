var autocompletes=[];function initAutocompletes(){console.log("init-autocompletes()");$.each(autocompletes,function(){console.log("Destroying: ",this);this.typeahead("destroy")});autocompletes.length=0;$(".xfRepeatItem [class$=-autocomplete-input]").each(function(){var c=$(this);var e=c.parent(".xfContainer").find("."+c.attr("name")+" .xfValue");console.log("parent: ",c.parent(".xfContainer"));console.log("xfValue: ",e," Value: ",e.val());c.val(e.val());var b=c.attr("name");var a=c.attr("queryType");var d=c.attr("host");console.log("Name: ",b," queryType: ",a," HOST:",d);c.typeahead({name:a,dataType:"json",minLength:3,limit:20,template:'<div class="th_wrapper"><div class="th_resources"><span class="img_{{resource}}"></span></div><div class="th_text_wrapper"><div class="th_value" title="{{type}}">{{value}}</div>{{#bio}}<div class="th_bio">{{/bio}}{{bio}}{{#bio}}</div>{{/bio}}{{#hint}}<div class="th_hint" title="{{hint}}"/>{{/hint}}</div><div class="th_sources">{{#sources}}<span class="img_{{.}}"></span>{{/sources}}</div></div>',engine:Hogan,remote:{url:d+"/exist/apps/cluster-services/modules/services/search/search.xql?"+a+"=%QUERY",filter:function(j){var h=[];if(Object.prototype.toString.call(j.result)==="[object Array]"){var h=[];for(i=0;i<j.result.length;i++){var g=null;if(j.result[i].bio!==undefined&&j.result[i].bio!==""){g=j.result[i].bio}var f=null;if(j.result[i].sources!==null){f=j.result[i].sources.split(/\b\s+/)}h.push({name:j.result[i].name,value:j.result[i].value,internalID:j.result[i].internalID,bio:g,earliestDate:j.result[i].earliestDate,latestDate:j.result[i].latestDate,uuid:j.result[i].uuid,resource:j.result[i].resource,type:j.result[i].type,sources:f,hint:j.result[i].hint})}}else{var g=null;if(j.result.bio!==undefined&&j.result.bio!==""){g=j.result.bio}h.push({name:j.result.name,value:j.result.value,internalID:j.result.internalID,bio:g,earliestDate:j.result.earliestDate,latestDate:j.result.latestDate,uuid:j.result.uuid,resource:j.result.resource,type:j.result.type,sources:j.result.sources.split(/\b\s+/),hint:j.result.hint})}return h}}}).on("typeahead:selected",function(k,f){console.log("typeahead:selected : ",f);var j=jQuery(k.target);var l=$("#"+c.attr("callbackSet")+" .xfRepeatIndex ."+c.attr("name")+" .xfValue");l.val(f.name);var m=l.attr("id");m=m.substring(0,m.indexOf("-value"));console.log("ID: ",m);fluxProcessor.sendValue(""+m,f.name);if(j.attr("queryType")==="names"){console.log("Names query.");if(f.bio!=null){console.log("Name BIO:",f.bio);console.log("Name earliestDate:",f.earliestDate);console.log("Name latestDate:",f.latestDate);if(f.earliestDate!=null){var h=$("#"+c.attr("callbackSet")+" .xfRepeatIndex input[placeholder=EarliestDate]");console.log("Name earliestDate:",h);h.val(f.earliestDate);var m=h.attr("id");m=m.substring(0,m.indexOf("-value"));console.log("ID: ",m);fluxProcessor.sendValue(""+m,f.earliestDate)}if(f.latestDate!=null){var g=$("#"+c.attr("callbackSet")+" .xfRepeatIndex input[placeholder=LatestDate]");console.log("Name earliestDate:",g);g.val(f.latestDate);var m=g.attr("id");m=m.substring(0,m.indexOf("-value"));console.log("ID: ",m);fluxProcessor.sendValue(""+m,f.latestDate)}}}else{if(j.attr(a)==="subjects"){console.log("Subjects query.")}else{console.log("Unknown query.")}}});autocompletes.push(c)})};